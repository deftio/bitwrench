(function(fn){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError}var t=Object(this);var len=t.length>>>0;if(len===0){return-1}var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n))}}if(n>=len){return-1}var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k}}return-1}}if(!fn.map)fn.map=function(f){var r=[];for(var i=0;i<this.length;i++)r.push(f(this[i]));return r};if(!fn.filter)fn.filter=function(f){var r=[];for(var i=0;i<this.length;i++)if(f(this[i]))r.push(this[i]);return r}})(Array.prototype);(function(root,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof module==="object"&&module.exports){module.exports=factory()}else{var module=factory();root[module["exportName"]]=module}})(typeof self!=="undefined"?self:this,function(){var bw={};bw.exportName="bw";"use strict";bw.choice=function(x,choices,def){return x in choices?choices[x]:def};bw.jsonClone=function(x){return JSON.decode(JSON.encode(x))};bw.typeOf=function(x,baseTypeOnly){if(x===null)return"null";var y=typeof x=="undefined"?"undefined":{}.toString.call(x).match(/\s([a-zA-Z]+)/)[1].toLowerCase();if(y!="object"&&y!="function")return y;if(baseTypeOnly==true)return y;return x.constructor.name.toLowerCase()==y.toLowerCase()?y:x.constructor.name};var _to=bw.typeOf;bw.to=bw.typeOf;bw.typeAssign=function(a,typeString,trueValue,falseValue){if(_to(typeString)=="string")typeString=[typeString];return typeString.indexOf(bw.typeOf(a))>=0?trueValue:falseValue};var _toa=bw.typeAssign;bw.toa=bw.typeAssign;bw.typeConvert=function(a,typeString,trueValue,falseValue){if(_to(typeString)=="string")typeString=[typeString];trueValue=_to(trueValue)=="function"?function(a){return trueValue(a)}:trueValue;falseValue=_to(falseValue)=="function"?function(a){return falseValue(a)}:falseValue;return typeString.indexOf(bw.typeOf(a))>=0?trueValue:falseValue};var _tc=bw.typeConvert;bw.tc=bw.typeConvert;var optsCopy=function(dopts,opts){if(_to(opts)=="object"&&_to(dopts)=="object"){var i;for(i in opts)dopts[i]=opts[i]}return dopts};bw.DOMIsElement=function(el){var r=false;try{if(_to(el)=="undefined")return r;if(bw.isNodeJS()==false)r=el instanceof Element}catch(e){r=typeof HTMLElement==="object"?el instanceof HTMLElement:el&&typeof el==="object"&&el!==null&&el.nodeType===1&&typeof el.nodeName==="string";bw.logd(e.toString())}return r};var _isEl=bw.DOMIsElement;bw.DOMGetElements=function(el,type){var r=[],a=[],i;if(bw.isNodeJS()==false){if(_isEl(el))return[el];if(_to(el)=="string"){type=_toa(type,"string",type,"auto");el.trim();if(type=="auto")type=bw.choice(el[0],{".":"className","#":"id"},"tagName");switch(type){case"id":el=el[0]=="#"?el.substring(1,el.length):el;a=document.getElementById(el);a=_toa(a,"null",[],[a]);break;case"className":el=el[0]=="."?el.substring(1,el.length):el;a=document.getElementsByClassName(el);break;case"tagName":a=document.getElementsByTagName(el);break;case"name":a=document.getElementsByName(el);break;default:}for(i in a)r.push(a[i])}}return r.filter(function(x){return bw.DOMIsElement(x)})};var _els=bw.DOMGetElements;bw.DOMSetElements=function(domElement,param){var els=bw.DOMGetElements(domElement);if(els==[])bw.log("dom element not found");var i,l,e,ef=function(x,p){bw.log(x,p)};for(l=0;l<els.length;l++){e=els[l];switch(bw.typeOf(param)){case"array":try{for(i=0;i<param.length;i++)e[param[i][0]]=param[i][1]}catch(d){ef(d,param)}break;case"object":try{for(i in param)e[i]=param[i]}catch(d){ef(d,param)}break;case"string":try{e.innerHTML=param}catch(d){ef(d,param)}break;case"function":try{param(e)}catch(d){ef(d,param)}break;default:break}}return els};bw.DOM=bw.DOMSetElements;bw.colorInterp=function(x,in0,in1,colors,stretch){var c=_toa(colors,"array",colors,["#000","#fff"]);c=c.length==0?["#000","#fff"]:c;if(c.length==1)return c[0];c=c.map(function(x){return bw.colorParse(x)});var a=bw.mapScale(x,in0,in1,0,c.length-1,{clip:true,expScale:stretch});var i=bw.clip(Math.floor(a),0,c.length-2);var r=a-i;var _f=function(x){return bw.mapScale(r,0,1,c[i][x],c[i+1][x],{clip:true})};return[_f(0),_f(1),_f(2),_f(3),"rgb"]};bw.colorHslToRgb=function(h,s,l,a){var r,g,b;if(s==0){r=g=b=l}else{var hue2rgb=function(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p};var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}var _fn=function(x){return bw.clip(Math.round(x),0,255)};return[_fn(r),_fn(g),_fn(b),a,"rgb"]};bw.colorRgbToHsl=function(r,g,b,a){r/=255,g/=255,b/=255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0}else{var d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return[h,s,l,a,"hsl"]};bw.colorParse=function(s,defAlpha){defAlpha=_toa(defAlpha,"number",defAlpha,255);var r=[0,0,0,defAlpha,"rgb"];if(_to(s)=="array"&&s.length==5){s=String(s[4])+"("+String(s[0])+","+String(s[1])+","+String(s[2])+","+String(s[3])+")"}s=String(s).replace(/\s/g,"");var reT=/\s*(#|hsl|rgb|yuv|hsv){1}([a-f|A-F|0-9|,().\t ]*)/gim;var i,j=0,x=reT.exec(s);if(_to(x)=="array"&&x.length>=3){r[4]=x[1]=="#"?"rgb":x;if(x[1]=="#"){switch(x[2].length){case 3:case 4:for(i=0;i<x[2].length;i++)r[i]=parseInt(x[2][i]+x[2][i],16);break;case 6:case 8:for(i=0;i<x[2].length;i+=2)r[j++]=parseInt(x[2][i]+x[2][i+1],16);break;default:bw.logd("bw.parseColor bad input "+s)}}else{r[4]=x[1].toLowerCase();if(x[2][0]=="("&&x[2][x[2].length-1]==")"){var v=x[2].substring(1,x[2].length-1);v=v.split(",");switch(v.length){case 3:case 4:for(i=0;i<v.length;i++)r[i]=Number(v[i]);break;default:bw.logd("bw.parseColor bad input : "+s)}}else{bw.logd("bw.parseColor bad input : "+s)}}}return r};bw.colorToRGBHex=function(c,format){var r="#00000000";var ph=function(x){var y=bw.clip(Math.round(x),0,255).toString(16);return y.length==1?"0"+y:y};if(_to(c)=="array"&&c.length==5){switch(c[4]){case"rgb":r="#"+ph(c[0])+ph(c[1])+ph(c[2]);if(!(format=="auto"&&c[3]==255))r+=ph(c[3]);break;case"hsl":var z=bw.colorHslToRgb(c[0],c[1],c[2]);r=bw.colorToRGBHex([z[0],z[1],z[2],c[3],"rgb"]);break;default:bw.logd("colorToRGBHex : unsupported format"+c[4])}}return r};var _logdata=[];bw.log=function(value,msg,opts){var dopts={clear:false,saveMethod:"raw"};dopts=optsCopy(dopts,opts);if(dopts["clear"]==true||dopts["clear"]=="clear-only"){_logdata=[["Time-stamp (ms)"," Value "," Message "]];_logdata.push([0,(new Date).getTime()," log started (absolute timestamp)"])}msg=_toa(msg,"undefined","",String(msg));value=dopts["saveMethod"]=="raw"?value:JSON.stringify(value);if(_to(value)!="undefined"&&dopts["clear"]!="clear-only")_logdata.push([(new Date).getTime()-_logdata[1][1],value,msg]);return _logdata.length-1};bw.log("","",{clear:"clear-only"});bw.logd=function(){var logdargs="bwlogd"in bw.bwargs?bw.bwargs["bwlogd"].split(","):[];if(logdargs.indexOf("none")<0){var i=0;var _a=[];for(i=0;i<arguments.length;i++)_a.push(arguments[i]);bw.log(_a,"bw.logd: "+bw.bwargs["bwlogd"])}};bw.logExport=function(opts){var dopts={format:"raw"};dopts=optsCopy(dopts,opts);var _ld=_logdata;if(dopts["format"]=="HTML"){return bw.makeHTMLTableStr(_ld,{sortable:true})}if(dopts["format"]=="text"){return _ld.map(function(x){return x.map(function(y){return bw.padString(y.toString(),16,"left")}).join("\t")}).join("\n")}return _ld};bw.setCookie=function(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+exdays*24*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+"; "+expires};bw.getCookie=function(cname,defaultValue){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1);if(c.indexOf(name)==0)return c.substring(name.length,c.length)}return defaultValue};bw.getURLParam=function(key,defaultValue){var params={};if(location.search){var parts=location.search.substring(1).split("&");for(var i=0;i<parts.length;i++){var nv=parts[i].split("=");if(!nv[0])continue;params[nv[0]]=nv[1]||true}}if(params.hasOwnProperty(key)==false)return defaultValue;return params[key]};var gBWTime=(new Date).getTime();bw.clearTimer=function(message){gBWTime=(new Date).getTime();if(_to(message)!="undefined")bw.logd(String(message));return gBWTime};bw.readTimer=function(message){var ct=(new Date).getTime();if(_to(message)!="undefined")bw.logd(String(message));return ct-gBWTime};bw.clearTimer();bw.htmlJSON=function(json){function f(json){json=JSON.stringify(json,undefined,2);if(typeof json!="string"){json=JSON.stringify(json,undefined,2)}json=json.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g,function(match){var sty="color: darkorange;";if(/^"/.test(match)){if(/:$/.test(match)){sty="color:red"}else{sty="color:purple"}}else if(/true|false/.test(match)){sty="color:grey"}else if(/null/.test(match)){sty="color:black"}else sty="color:green";return'<span style="'+sty+'">'+match+"</span>"})}return"<pre style=''>"+f(json)+"</pre>"};bw.prettyPrintJSON=bw.htmlJSON;bw.getFile=function(fname,callback_fn,options){var dops={parser:"raw"};dops=optsCopy(dops,options);if(_to(fname)!="string"){return"invalid filename"}var prs=dops["parser"]=="JSON"?JSON.parse:function(s){return s};if(bw.isNodeJS()==true){var fs=require("fs");fs.readFile(fname,"utf8",function(err,data){if(err)throw err;callback_fn(prs(data))})}else{var x=new XMLHttpRequest;x.overrideMimeType("application/json");x.open("GET",fname,true);x.onreadystatechange=function(){if(x.readyState==4&&x.status=="200"){callback_fn(prs(x.responseText))}};x.send(null)}return"BW_OK"};bw.getJSONFile=function(fname,callback_fn){return bw.getFile(fname,callback_fn,{parser:"JSON"})};bw.copyToClipboard=function(data){if(bw.isNodeJS())return;var listener=function(e){e.clipboardData.setData("text/html",data);e.clipboardData.setData("text/plain",data);e.preventDefault()};document.addEventListener("copy",listener);document.execCommand("copy");document.removeEventListener("copy",listener)};bw.saveClientFile=function(fname,data){if(bw.isNodeJS()){var fs=require("fs");fs.writeFile(fname,data,function(err){if(err)return bw.log(err);bw.log("error saving ",fname,data)})}else{var saveData=function(){var a=document.createElement("a");document.body.appendChild(a);a.style="display: none";return function(data,fname){var json=JSON.stringify(data),blob=new Blob([json],{type:"octet/stream"}),url=window.URL.createObjectURL(blob);a.href=url;a.download=fname;a.click();window.URL.revokeObjectURL(url)}}();saveData(data,fname)}};bw.setIntervalX=function(callback,delay,number_of_repetitions){var x=0;var intervalID=setInterval(function(){callback(x);if(++x>=number_of_repetitions){clearInterval(intervalID)}},delay)};bw.repeatUntil=function(testFn,successFn,failFn,delay,maxReps,lastFn){var _count=0;if(typeof testFn!="function")return"err";if(typeof delay!="number")delay=250;if(typeof maxReps!="number")maxReps=1;var _testFn=testFn;var _successFn=typeof successFn=="function"?successFn:function(){};var _failFn=typeof failFn=="function"?failFn:function(){};var _lastFn=typeof lastFn=="function"?lastFn:function(){};var _f=function(){var success=_testFn();if(true==success){_successFn();_lastFn(true,_count)}else{_failFn();if(_count>=maxReps){_lastFn(success,_count)}else{_count++;window.setTimeout(_f,delay)}}};_f()};bw.htmlSafeStr=function(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\n/g,"<br>")};bw.HTMLSafeStr=bw.htmlSafeStr;bw.makeHTMLPage=function(head,body,options){var dopts={docType:"<!DOCTYPE html>",htmlParams:{lang:"en"},headDefaultContent:[["meta",{"http-equiv":"Content-Type",content:"text/html",charset:"utf-8"},""]],headIncludeBitWrenchJS:false,headIncludeBitWrenchCSS:false,headFavicon:""};dopts=optsCopy(dopts,options);var s=dopts["docType"]+"\n";s+=bw.buildHTMLObjString(["html",dopts["htmlParams"],["\n",["head",{},["\n",dopts["headDefaultContent"].map(function(x){return bw.buildHTMLObjString(x)}).join("\n"),head,"\n"]],"\n",["body",{},["\n",body,"\n"]],"\n"]]);return s};bw.makeCSS=function(cssData,options){var dopts={emitStyleTag:false,atr:{}};dopts=optsCopy(dopts,options);var s="\n";var tb=function(a){a=String(a).trim();a=(a[0]=="{"?" ":" {")+a;a+=(a[a.length]=="}"?"":"}")+"\n";return a};try{switch(bw.typeOf(cssData)){case"string":s+=cssData+"\n";break;case"array":var i;for(i=0;i<cssData.length;i++){var j=cssData[i];switch(bw.typeOf(j)){case"string":s+=j+"\n";break;case"array":if(j.length==1&&bw.typeOf(j[0])=="string"){s+=j[0]+"\n";break}if(j.length==2){if(bw.typeOf(j[0])=="string"){s+=j[0]+tb(j[1]);break}if(bw.typeOf(j[0])=="array")s+=j[0].join(",")+tb(j[1])}break;default:}}break;default:s=""}}catch(e){}if(dopts["emitStyleTag"]){s=bw.html(["style",dopts["atr"],s])}return s};bw.html_fc=function(x){var i,n={t:"div",a:{},c:"",o:{}};var m="";switch(_to(x)){case"null":case"undefined":n=x;break;case"object":[["tag","t"],["attrib","a"],["content","c"],["options","o"]].forEach(function(z){n[z[1]]=z[0]in x?x[z[0]]:n[z[1]]});for(i in n){n[i]=i in x?x[i]:n[i];if(bw.isnu(n[i])){n=null;m="HTML gen err: bad object";break}}break;case"array":var idx=[[],["c"],["t","c"],["t","a","c"],["t","a","c","o"],["t","a","c","o","s"]];var m=x.length>5?5:x.length;for(i=0;i<m;i++){console.log(idx[m][i]+":"+x[i]);n[idx[m][i]]=x[i]}for(i in n)if(bw.isnu(n[i])){n=null;m="HTML gen err: bad array";break}break;case"function":n=bw.html_fc2(x(),opts);break;default:n.c=x.toString()}return n};bw.HTMLNorm=function(x){function bwHTMLNode(){this.t="div";this.a={};this.c="";this.o={}}function bwError(v,x){this.value=v;this.msg=typeof x=="undefined"?"error":x}var i,n=new bwHTMLNode;var m="";switch(_to(x)){case"null":case"undefined":n=new bwError(x,"HTML Node error : "+_to(x));break;case"object":[["tag","t"],["attrib","a"],["content","c"],["options","o"]].forEach(function(z){n[z[1]]=z[0]in x?x[z[0]]:n[z[1]]});for(i in n){n[i]=i in x?x[i]:n[i];if(bw.isnu(n[i])){n=null;m="HTML gen err: bad object";break}}break;case"array":var idx=[[],["c"],["t","c"],["t","a","c"],["t","a","c","o"],["t","a","c","o","s"]];var m=x.length>5?5:x.length;for(i=0;i<m;i++){console.log(idx[m][i]+":"+x[i]);n[idx[m][i]]=x[i]}for(i in n)if(bw.isnu(n[i])){n=null;m="HTML gen err: bad array";break}break;case"function":n=bw.html_fc2(x(),opts);n=_to(n)=="function"?new bwError(n.toString(),"HTML Node error: function returned a function"):n;break;default:n.c=x.toString()}return n};bw.htmld=function(htmlJSON,opts){var dopts={t_close:"auto",a_join:";",o_pretty:false,o_indent:4,o_verbose:false,c_htmlesc:true};dopts=optsCopy(dopts,opts);var stk=[],i,d,h="",ind_s,ind_e;h="";d=bw.html_fc(htmlJSON);for(i in d)if(_to(i)=="function")d[i]=d[i](d);d.s["level"]++;d.t=d.t.toString();d.a=_to(d.a)=="object"?d.a:{};d.c=_to(d.c)=="array"?d.c:_to(d.c)=="object"?html_fc(d.c):d.c.toString();d.o=optsCopy(dopts,d.o);ind_s=d.o.o_pretty?Array(d.s.level*d.o.o_indent).join(" "):"";ind_e=d.o.o_pretty?"\n":"";h+=ind_s+"<"+d.t;for(i in d.a)h+=" "+i+'="'+d.a[i]+'"';h+=">"+ind_e;switch(_to(d.c)){case"object":h+=bw.htmld(d.c,dopts);break;case"array":h+=d.c.map(function(x){return bw.htmld(x,dopts)}).join("");break;default:h+=d.c}h+=ind_s+"</"+d.t+">"+ind_e;d.s.html=h;return d};bw.html=function(d,options){var dopts={pretty:false,indent:0,indentStr:"  "};var outFn=function(s,opts){var w=Array(opts["indent"]).join(opts["indentStr"]);var we=Array(opts["indent"]-1).join(opts["indentStr"]);return opts["pretty"]?"\n"+w+s+"\n"+we:s};dopts=optsCopy(dopts,options);dopts["indent"]++;var s="",t="",a={},c=[],i;switch(bw.typeOf(d)){case"date":case"number":s=String(d);case"string":s=d;return outFn(s,dopts);break;case"function":s=bw.buildHTMLObjString(d(),dopts);break;case"array":if(bw.typeOf(d[0])=="undefined"||d.length!=3)return"";t=bw.typeOf(d[0])!="undefined"?d[0]:t;a=bw.typeOf(d[1])!="undefined"?d[1]:a;c=bw.typeOf(d[2])!="undefined"?d[2]:c;t=bw.typeOf(t)=="function"?t():t;a=bw.typeOf(a)=="function"?a():a;c=bw.typeOf(c)=="function"?c():c;c=bw.typeOf(c)!="array"?[c]:c;break;case"object":t=bw.typeOf(d["t"])=="function"?d["t"]():t;t=bw.typeOf(d["tag"])=="function"?d["tag"]():t;t=bw.typeOf(d["t"])=="string"?d["t"]:t;t=bw.typeOf(d["tag"])=="string"?d["tag"]:t;a=bw.typeOf(d["a"])=="function"?d["a"]():a;a=bw.typeOf(d["atr"])=="function"?d["atr"]():a;a=bw.typeOf(d["a"])=="object"?d["a"]:a;a=bw.typeOf(d["atr"])=="object"?d["atr"]:a;switch(bw.typeOf(d["c"])){case"function":c=d["content"]();break;case"array":c=d["content"];break;default:c=[d["content"]]}switch(bw.typeOf(d["c"])){case"function":c=d["c"]();break;case"array":c=d["c"];break;default:c=[d["c"]]}break;default:bw.log("bw.buildHTMLObjString:: error in type")}s+="<"+t;for(i in a){s+=" "+String(i)+'="'+String(a[i])+'"'}s+=">";for(i=0;i<c.length;i++){var _c="";switch(bw.typeOf(c[i])){case"function":_c=c[i]();case"object":case"array":_c=bw.buildHTMLObjString(c[i],dopts);break;default:_c=String(c[i])}s+=_c}s+="</"+t+">";return outFn(s,dopts)};bw.makeHTML=bw.html;bw.buildHTMLObjString=bw.html;bw.htmla=function(listData,options){if(bw.typeOf(listData)!="array")return bw.html(listData,options);return listData.map(function(x){return bw.html(x,options)}).join("")};bw.htmlList=function(listData,listType,atr,atri){if(bw.typeOf(listData)!="array")return"";if(listData.length<1)return"";atr=_toa(atr,"object",atr,{});atri=_toa(atr,"object",atr,{});var lc=listData.map(function(x){return bw.buildHTMLObjString(["li",atri,x])});return bw.html([listType,atr,lc])};bw.makeHTMLList=bw.htmlList;bw.htmlTabs=function(tabData,atr){if(bw.typeOf(tabData)!="array")return"";if(tabData.length<1)return"";atr=bw.typeOf(atr)=="object"?atr:{};var ti=tabData.map(function(x){return["li",{class:"bw-tab",onclick:"bw.selectTabContent(this)"},x[0]]});var tc=tabData.map(function(x){return["div",{class:"bw-tab-content"},x[1]]});ti[0][1]["class"]=ti[0][1]["class"]+" bw-tab-active";tc[0][1]["class"]=tc[0][1]["class"]+" bw-show";if("class"in atr)atr["class"]+=atr["class"].split(/\s+/gi).indexOf("bw-tab-container")<0?" bw-tab-container":"";else atr["class"]="bw-tab-container";return bw.html(["div",atr,[["ul",{class:"bw-tab-item-list"},ti],["div",{class:"bw-tab-content-list"},tc]]])};bw.makeHTMLTabs=bw.htmlTabs;bw.htmlTable=function(data,opts){if(bw.typeOf(data)!="array"||data.length<1)return"";var dopts={useFirstRowAsHeaders:true,atr:{},thead_atr:{},th_atr:{},tbody_atr:{},tr_atr:{},td_atr:{},caption:"",sortable:false};var i=0,head="",body="",r,_hs=bw.buildHTMLObjString;dopts=optsCopy(dopts,opts);if(bw.typeOf(dopts.th_atr["onclick"])=="function"){bw.log("todo buildHTMLtable function dispatch")}if(dopts.sortable==true){dopts.th_atr["onclick"]="bw.sortTableDispatch(this)";if("class"in dopts.th_atr)dopts.th_atr["class"]+=dopts.th_atr["class"].split(/[ ]+/).indexOf("bw-table-sort-xxa")<0?" bw-table-sort-xxa":"";else dopts.th_atr["class"]="bw-table-sort-xxa"}else{if(bw.typeOf(dopts.sortable)=="function"){var sfid=bw.funcRegister(dopts.sortable);dopts.th_atr["onclick"]=bw.funcGetDispatchStr(sfid,"this");bw.log("todo function makeHTML sort function dispatch")}}if(dopts["useFirstRowAsHeaders"]){head=data[0].map(function(x){return _hs(["th",dopts.th_atr,x])}).join("");head=_hs(["tr",dopts.tr_atr,head]);i=1}else i=0;head=bw.buildHTMLObjString(["thead",dopts.thead_atr,head]);for(;i<data.length;i++){r=data[i].map(function(x){return _hs(["td",dopts.td_atr,x])}).join("");body+=_hs(["tr",dopts.tr_atr,r])}body=bw.buildHTMLObjString(["tbody",dopts.tbody_atr,body]);dopts.caption=dopts.caption==""?"":_hs(["caption",{},dopts.caption]);return _hs(["table",dopts.atr,[dopts.caption,head,body]])};bw.makeHTMLTableStr=bw.htmlTable;bw.naturalSort=function(as,bs){var a,b,a1,b1,i=0,L,rx=/(\d+)|(\D+)/g,rd=/\d/;if(isFinite(as)&&isFinite(bs))return as-bs;a=String(as).toLowerCase();b=String(bs).toLowerCase();if(a===b)return 0;if(!(rd.test(a)&&rd.test(b)))return a>b?1:-1;a=a.match(rx);b=b.match(rx);L=a.length>b.length?b.length:a.length;while(i<L){a1=a[i];b1=b[i++];if(a1!==b1){if(isFinite(a1)&&isFinite(b1)){if(a1.charAt(0)==="0")a1="."+a1;if(b1.charAt(0)==="0")b1="."+b1;return a1-b1}else return a1>b1?1:-1}}return Math.sign(a.length-b.length)};bw.sortHTMLTable=function(table,col,dir,sortFunction){var rows,switching,i,x,y,shouldSwitch;var sortF=bw.typeOf(sortFunction)=="function"?sortFunction:bw.naturalSort;table=_isEl(table)?table:_els(table);dir=dir==true||dir=="up"?true:false;switching=true;col=bw.typeOf(col)=="number"?col:0;while(switching){switching=0;rows=table.getElementsByTagName("TR");for(i=1;i<rows.length-1;i++){shouldSwitch=0;x=rows[i].getElementsByTagName("TD")[col].innerHTML;y=rows[i+1].getElementsByTagName("TD")[col].innerHTML;shouldSwitch=dir?sortF(x,y,col)>0:sortF(x,y,col)<0;if(shouldSwitch)break}if(shouldSwitch){rows[i].parentNode.insertBefore(rows[i+1],rows[i]);switching=true}}};bw.sortTableDispatch=function(item,fn){var i;if(bw.typeOf(item)=="string")item=document.getElementById(item);if(bw.typeOf(item).substr(0,4)!="html")return false;var index=0,dir;var cols=item.parentElement.getElementsByTagName("th");for(i=0;i<cols.length;i++){if(cols[i]==item){index=i;dir=bw.markElement(cols[i],"bw-table-sort-upa");if(dir){bw.markElement(cols[i],"bw-table-sort-upa","bw-table-sort-dna")}else{if(bw.markElement(cols[i],"bw-table-sort-dna")){bw.markElement(cols[i],"bw-table-sort-dna","bw-table-sort-upa")}else bw.markElement(cols[i],"bw-table-sort-xxa","bw-table-sort-upa")}}else{bw.markElement(cols[i],"bw-table-sort-upa","");bw.markElement(cols[i],"bw-table-sort-dna","");bw.markElement(cols[i],"bw-table-sort-xxa","bw-table-sort-xxa")}}bw.sortHTMLTable(item.parentElement.parentElement.parentElement,index,dir,fn)};var _fnRegistry={};var _fnIDCounter=0;bw.funcRegister=function(fn,forceName){var fnID="class_bwfn_"+_fnIDCounter;_fnIDCounter++;fnID=bw.typeOf(forceName)=="string"?forceName:fnID;fnID.trim();_fnRegistry[fnID]=fn;return fnID};bw.funcUnregister=function(fnID){if(fnID in _fnRegistry)delete _fnRegistry[fnID]};bw.funcGetById=function(fnID,errFn){fnID=String(fnID);if(fnID in _fnRegistry)return _fnRegistry[fnID];else{var _id=fnID;return bw.typeOf(errFn)=="function"?errFn:function(){bw.log(_id,"bw.funcGetById(): unregistered fn error")}}};bw.funcGetDispatchStr=function(fnID,argstring){switch(bw.typeOf(argstring)){case"string":case"number":argstring=String(argstring);break;case"array":argstring=argstring.join(",");break;case"function":argstring=argstring();break;default:argstring=""}return"bw.funcGetById('"+fnID+"')("+argstring+")"};bw.loremIpsum=function(numChars,startSpot,startWithCapitalLetter){startSpot=_to(startSpot)!="number"?0:Math.round(startSpot);var l="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. ";startSpot=startSpot%l.length;l=l.substring(startSpot,l.length)+l.substring(0,startSpot);if(bw.typeOf(numChars)!="number")numChars=l.length;var i=numChars,s="";while(i>0){s+=i<l.length?l.substring(0,i):l;i-=l.length}if(s[s.length-1]==" ")s=s.substring(0,s.length-1)+".";if(startWithCapitalLetter==true&&s[0].match(/[A-Z]/)==null)s="M"+s.substring(1,s.length);return s};bw.docString=function(s,options){var dopts={docType:"jsdoc",delims:["/**","*/"],parseJSDocParams:false,dropLeadin:false};dopts=optsCopy(dopts,options);var _es=function(str){return str.replace(/(?=[\\^$*+?.()|{}[\]])/g,"\\")};dopts["delims"]=bw.choice(dopts["docType"],{jsdoc:["/**","*/"],python:['"""','"""'],jspy:['/**"""','"""*/']},dopts["delims"]);var c=_to(s)=="function"?s.toString():String(s);var r=[];try{var re=new RegExp(_es(dopts["delims"][0])+"\\s*\\n*([^\\*]|(\\*(?!\\/)))*"+_es(dopts["delims"][1]),"ig");r=c.match(re)}catch(e){bw.log(String(e))}if(_to(r)=="array"){r=r.map(function(x){return x.substring(dopts["delims"][0].length,x.length-dopts["delims"][1].length)});r=dopts["dropLeadin"]==true?r.map(function(x){return x.split(/[\n\r]/).map(function(y){return bw.trim(y,"left")+"\n"})}):r}else r=[];return r};bw.docStringParseLine=function(s){var r={source:s,field:"",types:"",name:"",description:""};var a=s.replace(/^\s*(\/\*\*?)?|(\*\/)?\s*$/gi,"");a=a.replace(/^\s*\**\s*/,"");if(a.charAt(0)=="@"){var e,x;var t=bw.trim;e=/^@([A-Za-z0-9_<>[\]]*)/i;x=a.match(e);if(x!=null){r["field"]=t(x[1])}else return r;a=a.replace(e,"");e=/^\s*\{([A-Za-z0-9_|\s,.\-+!@#$%^&*()=[\]]*)\}/i;x=a.match(e);if(x!=null){r["types"]=t(x[1])}a=a.replace(e,"");e=/^\s*([\S]*)/i;x=a.match(e);if(x!=null){r["description"]=t(x[1])}a=a.replace(e,"");e=/^\s*([\S]*)/i;x=a.match(e);if(x!=null){r["name"]=t(x[1])}a=a.replace(e,"");if(r["name"].match(/^\s*-+\s*/)!=null){r["name"]=r["description"];r["description"]=t(a)}else{r["description"]=r["description"]+" "+r["name"]+" "+t(a);r["name"]=""}}return r};bw.docStringParse=function(s){s=bw.docString(s)[0];var a=s.split("\n");var i,r=[bw.docStringParseLine(a[0])];for(i=1;i<a.length;i++){var l=bw.docStringParseLine(a[i]);if(l["field"]==""){if(r[r.length-1]["field"]==""){r[r.length-1]["source"]+=l["source"]}else r[r.length-1]["description"]+=l["source"]}else r.push(l)}return r};bw.isHexStr=function(str,allowChars){if(_to(str)=="string"){str=str.replace(new RegExp("["+allowChars+"]","g"),"");var isHexReg=new RegExp("^[0-9A-Fa-f]{"+str.length+"}$");return isHexReg.test(str)==true?str.length:false}return false};bw.isNodeJS=function(){return(typeof module!=="undefined"&&module.exports)!==false};bw.fixNum=function(num,digits){num=Number(num);if(isNaN(num))return NaN;digits=bw.typeOf(digits)=="number"?digits:3;num*=Math.pow(10,digits);num=num>0?Math.floor(num):Math.ceil(num);num/=Math.pow(10,digits);return num};bw.multiArray=function(value,dims){var v=function(){return _to(value)=="function"?value():value};dims=_to(dims)=="number"?[dims]:dims;var _array=function(a,dim){if(dim<dims.length){for(var i=0;i<dims[dim];i++){a[i]=dim==dims.length-1?v():_array([],dim+1)}return a}};return _array([],0)};bw.clip=function(data,min,max){var l=min<max?min:max;var h=max>min?max:min;if(_to(data)=="array"){return data.map(function(x){return x<l?l:x>h?h:x})}else return data<l?l:data>h?h:data};bw.mapScale=function(x,in0,in1,out0,out1,options){var dopts={clip:true,expScale:false};dopts=optsCopy(dopts,options);if(in0==in1)return x;out0=_toa(out0,"number",out0,0);out1=_toa(out1,"number",out1,1);var ms=function(z){if(dopts["expScale"]){var y=(z-(in1+in0)/2)/(in1-in0)*dopts["expScale"];z=(out1-out0)*(1/(1+Math.exp(-y)))+out0}else z=(z-in0)/(in1-in0)*(out1-out0)+out0;if(dopts["clip"])z=bw.clip(z,out0,out1);return z};if(_to(x)=="number")return ms(x);return x.map(ms)};bw.padNum=function(x,width,options){var dopts={padChar:" "};dopts=optsCopy(dopts,options);x=String(x);return x.length>=width?x:new Array(width-x.length+1).join(dopts["padChar"])+x};bw.trim=function(s,dir){var t=bw.choice(dir,{left:/^[\s\uFEFF\xA0\n]+/g,right:/[\s\uFEFF\xA0\n]+$/g,none:/(?!)/},/^[\s\uFEFF\xA0\n]+|[\s\uFEFF\xA0\n]+$/g);return String(_toa(s,"undefined","",s)).replace(t,"")};bw.padString=function(s,width,dir,options){var dopts={padChar:" ",trimDir:"both"};dopts=optsCopy(dopts,options);s=String(s);var x=bw.trim(s,dopts["trimDir"]);var p=width>x.length?width-x.length+1:0;var q=bw.choice(dir,{left:[p,0],right:[0,p],center:[Math.round(p/2),p-Math.round(p/2)+1]},[0,0]);return new Array(q[0]).join(dopts["padChar"])+x+new Array(q[1]).join(dopts["padChar"])};bw.random=function(rangeBegin,rangeEnd,options){rangeBegin=bw.typeOf(rangeBegin)=="number"?rangeBegin:0;rangeEnd=bw.typeOf(rangeEnd)=="number"?rangeEnd:100;var dopts={setType:"int",dims:false};dopts=optsCopy(dopts,options);var _rnd=function(){var n=0;dopts.setType=["int","float","number"].indexOf(dopts.setType)==-1?"int":dopts.setType;if(rangeEnd<rangeBegin){rangeBegin^=rangeEnd;rangeEnd^=rangeBegin;rangeBegin^=rangeEnd}n=Math.random()*(rangeEnd-rangeBegin)+rangeBegin;return dopts.setType=="int"?Math.round(n):n};if(_to(dopts["dims"])=="array"||_to(dopts["dims"])=="number")return bw.multiArray(_rnd,dopts["dims"]);return _rnd()};bw.hashFnv32a=function(str,seed,returnHexStr){var i,l,hval=typeof seed=="undefined"?2166136261:seed;for(i=0,l=str.length;i<l;i++){hval^=str.charCodeAt(i);hval+=(hval<<1)+(hval<<4)+(hval<<7)+(hval<<8)+(hval<<24)}if(returnHexStr){return("0000000"+(hval>>>0).toString(16)).substr(-8)}return hval>>>0};bw.prandom=function(rangeBegin,rangeEnd,seed,options){rangeBegin=bw.typeOf(rangeBegin)=="number"?rangeBegin:0;rangeEnd=bw.typeOf(rangeEnd)=="number"?rangeEnd:100;var dopts={setType:"int",dims:false};dopts=optsCopy(dopts,options);var _rnd=function(){var n=0;dopts.setType=["int","float","number"].indexOf(dopts.setType)==-1?"int":dopts.setType;if(rangeEnd<rangeBegin){rangeBegin^=rangeEnd;rangeEnd^=rangeBegin;rangeBegin^=rangeEnd}n=(bw.hashFnv32a("start string",seed)&65535)/65536*(rangeEnd-rangeBegin)+rangeBegin;return dopts.setType=="int"?Math.round(n):n};if(_to(dopts["dims"])=="array"||_to(dopts["dims"])=="number")return bw.multiArray(_rnd,dopts["dims"]);return _rnd()};bw.bwMakeThemeCSS=function(color){var c=bw.colorRgbToHsl(bw.colorParse(color));var p="bw-theme-";var thm=["l5","l4","l3","l2","l1","d1","d2","d3","d4","d5"].map(function(x){return p+x});var im=" !important";thm=thm.map(function(x,i){return[x,[["color",(i<5?"#000":"#fff")+im],["background-color",c+im]]]});return thm};bw.bwSimpleStyles=function(appendToHead,options){var s="\n",m="";var _r=bw.fixNum;var dopts={globals:false,id:"bw-default-styles",exportCSS:false};dopts=optsCopy(dopts,options);var defContainer="{height: 100%;  width: 94%;  margin: 0 auto;  padding-left: 2%; padding-right:2%; left: 0;  top: 1%;}\n";var defFontSerif="{font-family: Times New Roman, Times, serif;}\n";var defFontSansSerif="{font-family: Arial, Helvetica, sans-serif }\n";if(dopts["globals"]=="load"){s+="\nhtml,body "+defContainer;s+="*"+defFontSansSerif}s+=".bw-def-page-setup"+defContainer;s+=".bw-font-serif"+defFontSerif;s+=".bw-font-sans-serif"+defFontSansSerif;s+=[1,2,3,4,5,6].map(function(x){return".bw-h"+x+"{ font-size: "+_r(3.2*Math.pow(.85,x+1))+"rem;}"}).join("\n")+"\n";s+=".bw-left       { text-align: left;                            }\n";s+=".bw-right      { text-align: right;                           }\n";s+=".bw-center     { text-align: center; margin: 0 auto;          }\n";s+=".bw-justify    { text-align: justify;                         }\n";s+=".bw-code       { font-family:monospace; white-space:pre-wrap; }\n";s+=".bw-pad1       { padding-left: 1%; padding-right: 1%;         }\n";s+=".bw-table-stripe    tr:nth-child(even){  background-color: #f0f0f0}\n";s+=".bw-table-col0-bold tr td:first-child {   font-weight: 700;}\n";s+=".bw-table-compact   { border-collapse: collapse; border-spacing: 0;}\n";s+='.bw-table-sort-upa::after { content: "\\2191"; }\n';s+='.bw-table-sort-dna::after { content: "\\2193"; }\n';s+='.bw-table-sort-xxa::after { content: "\\00a0"; }\n';s+=".bw-tab-item-list { padding:0;}\n";s+=".bw-tab           { padding-top:1%; padding-left: 1%; padding-right: 1%; padding-bottom: 20px;  margin-bottom: 2%; display:inline; position:relative; border-top-right-radius: 7px; border-top-left-radius: 7px;}\n";s+=".bw-tab-active    { background-color : #eee; font-weight:700;}\n";s+=".bw-tab:hover     { cursor: pointer;  font-weight: 700;/* font-weight: 700; border: 1px  solid #bbb; */}\n";s+=".bw-tab-content   { background-color : #eee;  display: none; }\n";s+=".bw-tab-content, .bw-tab-active       {background-color: #ddd}\n";s+=".bw-container  { margin: 0 auto;  }\n";s+=".bw-row        { width: 100%; display: block;  }\n";s+='.bw-row [class^="bw-col"] {  float: left;}\n';s+=[1,2,3,4,5,6,7,8,9,10,11,12].map(function(x){return".bw-col-"+x+" {width:"+_r(x*100/12)+"%;"+m+" }"}).join("\n");s+="\n";s+='.bw-row::after { content: "";   display: table; clear: both;}\n';s+=".bw-box-1 {padding-top: 10px; padding-bottom: 10px; border-radius: 8px;}\n";s+=".bw-hide   { display: none;}\n";s+=".bw-show   { display: block;}\n";s+="@media only screen and (min-width: 540px) {  .bw-container {    width: 94%;  }}\n";s+="@media only screen and (min-width: 720px) {  .bw-container {    width: 90%;  }}\n";s+="@media only screen and (min-width: 960px) {  .bw-container {    width: 86%;  }}\n";s+="\n";if(bw.isNodeJS()==false){var h=document.getElementsByTagName("head")[0];var el=document.createElement("style");el.id=dopts["id"];el.textContent=s;if(appendToHead&&document.getElementById(dopts["id"])==null)h.appendChild(el)}if(dopts["exportCSS"])s=bw.buildHTMLObjString(["style",{id:dopts["id"]},"\n/**\n bitwrench basic css styles\n version: "+bw.version()["version"]+"\n */"+s]);return s};bw.bwSimpleThemes=function(d,appendToHead){var s="",xs={},i;var def=[{"*":"background-color: #333; color: #ddd; font-family: sans-serif; box-sizing:border-box;",body:"margin-top:1%;",th:"background-color: #555","tbody tr:nth-child(even)":"background-color: #f0f0f0","table, td, th":"border-collapse: collapse; border:1px solid #ddd; ","td,th":"padding:4px; ","div,body,button,table,input":"border-radius: 5px"},{"*":"background-color: #f8f8f8; color: #111; font-family: sans-serif; box-sizing:border-box;",body:"margin-top:1%;",th:"background-color: #ddd","tbody  tr:nth-child(even)":"background-color: #ddd","table, td, th":"border-collapse: collapse; border:1px solid #111; ","td,th":"padding:4px; ","div,body,button,table,input":"border-radius: 7px;"}];xs=bw.choice(_to(d),{object:d,number:d>=0&&d<def.length?def[d]:def[0]},def[0]);for(i in xs){s+=i+" "+"{"+xs[i]+"}\n"}if(appendToHead!=false){var hs=document.getElementById("bw-simple-theme-styles");if(hs==null){var h=document.getElementsByTagName("head")[0];var el=document.createElement("style");el.id="bw-simple-theme-styles";el.textContent=s;h.appendChild(el)}else{hs.textContent=s}}return s};bw.selectTabContent=function(item,target){if(bw.typeOf(item)=="string")item=document.getElementById(item);if(bw.typeOf(item).substr(0,4)!="html")return false;var index=0;var cols=item.parentElement.getElementsByTagName("li");for(i=0;i<cols.length;i++){if(cols[i]==item){index=i;bw.markElement(cols[i],"bw-tab-active","bw-tab-active")}else{bw.markElement(cols[i],"bw-tab-active","")}}var tcols=item.parentNode.parentNode.getElementsByClassName("bw-tab-content-list")[0].getElementsByClassName("bw-tab-content");if(tcols.length<=0)return false;target=bw.typeOf(target)=="undefined"?tcols[index]:target;target=bw.typeOf(target)=="string"?document.getElementById(target):target;var i;for(i=0;i<tcols.length;i++){if(tcols[i]==target)bw.markElement(tcols[i],"bw-show","bw-show");else bw.markElement(tcols[i],"bw-show","")}return true};bw.markElement=function(el,key,replace){var r=false;if(bw.typeOf(el)=="string")el=document.getElementById(el);try{var c=el.className.split(/[ ]+/);var i=c.indexOf(key);if(i>=0)r=true;if(bw.typeOf(replace)=="string"&&c.indexOf(replace)==-1){if(i==-1)c.push(replace);else{if(replace.length>0)c[i]=replace;else c.splice(i,1)}el.className=c.join(" ").trim();r=true}}catch(e){bw.log(e)}return r};bw.version=function(){var v={version:"1.1.44",about:"bitwrench is a simple library of miscellaneous Javascript helper functions for common web design tasks.",copy:"(c) M A Chatterjee deftio (at) deftio (dot) com",url:"http://github.com/deftio/bitwrench",license:"BSD-2-Clause"};return v};bw.bwargs={enableUJURLArgs:"true"};var parseArgs=function(s){var args={};if(typeof s=="string"&&s!=""){s=s.split(";");var j;for(j in s){var k=s[j].split(":");args[k[0]]=k[1]}}return args};var getArgs=function(){if(bw.isNodeJS()==false){var els=document.getElementsByTagName("script");var i,a,b;for(i in els){try{var el=els[i];if(el.hasOwnProperty("src")!=false)break;var s=String(el.getAttribute("src"));var f="bitwrench.js";if(s.toLowerCase().substring(s.length-f.length,s.length)==f.toLowerCase()){s=_to(s)=="string"?el.getAttribute("bwargs"):[""];s=_to(s)=="string"?el.getAttribute("data-bwargs"):s;a=parseArgs(s);for(b in a)bw.bwargs[b]=a[b]}}catch(e){}}if(bw.bwargs["enableUJURLArgs"]=="true"){a=parseArgs(bw.getURLParam("bwargs",""));for(b in a)bw.bwargs[b]=a[b]}}};getArgs();var loadStyles=bw.bwargs["bw-load-styles"]!="false";var loadStyleBasics=bw.typeAssign(bw.bwargs["bw-load-style-basics"],"string",bw.bwargs["bw-load-style-basics"],"load");bw.bwSimpleStyles(loadStyles,{basics:loadStyleBasics});bw.funcRegister(bw.log,"bw_log");return bw});